services:
  connectors: # container for the API connectors
    image: "python:3.12-bookworm"
    container_name: sk-connectors
    working_dir: /usr/src/
    env_file:
      - .env
    volumes:
      - ./connectors:/usr/src/
    command: sleep infinity
    depends_on:
      - api
    networks:
      - sk-net

  compute: # for computations on data
    image: "python:3.12-bookworm"
    container_name: sk-compute
    working_dir: /usr/src/
    env_file:
      - .env
    depends_on:
      - api
    volumes:
      - ./compute:/usr/src/
    command: sleep infinity
    networks:
      - sk-net

  api: # REST API
    image: "python:3.12-bookworm"
    container_name: sk-api
    working_dir: /usr/src/
    env_file:
      - .env
    ports:
      - "8000:8000"
    entrypoint: "/usr/src/entry-point.sh"
    restart: on-failure
    depends_on:
      - db
    volumes:
      - ./backend/:/usr/src/
    networks:
      - sk-net

  web:
    image: "node:22-alpine"
    container_name: sk-web
    working_dir: /home/node/
    user: "node"
    ports:
      - ${VITE_PORT:-3000}:${VITE_PORT:-3000}
    depends_on:
      - api
    command: sleep infinity
    volumes:
      - ./frontend/:/home/node
      - ./frontend/dist:/home/node/dist/:rw
    networks:
      - sk-net

  db: # local storage
    container_name: sk-db
    image: postgres:17-alpine
    restart: unless-stopped
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-sk-db}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-password}
      POSTGRES_DB: ${POSTGRES_DB:-sk-db}
      POSTGRES_HOST: ${POSTGRES_HOST:-sk-db}
      POSTGRES_PORT: ${POSTGRES_PORT:-5432}
    volumes:
      - sk-db-data:/var/lib/postgresql/data
    ports:
      - "${POSTGRES_PORT:-5432}:${POSTGRES_PORT:-5432}"
    networks:
      - sk-net

volumes:
  sk-db-data:
    driver: local

networks:
  sk-net:
    name: sk-network
    driver: bridge
